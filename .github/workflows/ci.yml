name: CI

# This workflow triggers on push events to the main branch and pull requests.
# It is designed to build and test the ZenithPDF desktop application.

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    name: Build & Test
    runs-on: ubuntu-latest

    steps:
      - name: ğŸš€ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Set up Node.js (Required for Vite/Tauri)
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a specific Node.js version compatible with Vite/Tauri
          cache: 'npm' # Cache npm dependencies

      - name: ğŸ› ï¸ Install Dependencies
        run: npm ci # Use 'ci' for clean installs in CI environments

      - name: ğŸ“ Lint and Format Check (Biome)
        run: npx @biomejs/biome check --apply-unsafe ./src # Run lint and format checks, apply fixes for unsafe ones if applicable. For CI, typically just 'check' is used to fail on violations.

      - name: ğŸ§ª Unit and Integration Tests (Vitest)
        run: npm run test:unit # Assumes a script 'test:unit' exists in package.json that runs Vitest

      - name: ğŸ“¸ End-to-End Tests (Playwright)
        run: npm run test:e2e # Assumes a script 'test:e2e' exists in package.json that runs Playwright tests

      - name: ğŸ“¦ Build Desktop Application (Tauri)
        run: npm run build:tauri # Assumes a script 'build:tauri' exists in package.json for building the Tauri app
        env:
          # Environment variables required for building, e.g., signing certificates, API keys
          TAURI_SKIP_SIGN: 1 # Example: Skip signing for CI builds if not necessary or handled elsewhere
          # CI=true # Standard CI environment variable

      # Optional: Upload build artifacts if needed for distribution
      # - name: â¬†ï¸ Upload Artifacts
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: zenithpdf-build
      #     path: src-tauri/target/release/ # Path to built binaries
